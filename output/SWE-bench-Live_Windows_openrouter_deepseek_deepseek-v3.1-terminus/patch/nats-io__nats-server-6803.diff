git --no-pager diff HEAD --diff-filter=M --text
diff --git a/server/certstore/certstore_windows.go b/server/certstore/certstore_
_windows.go
index d47adb6ee..946848d4c 100644
--- a/server/certstore/certstore_windows.go
+++ b/server/certstore/certstore_windows.go
@@ -541,7 +541,7 @@ func (k winKey) Public() crypto.PublicKey {
 func (k winKey) Sign(_ io.Reader, digest []byte, opts crypto.SignerOpts) ([]byt
te, error) {
        switch k.AlgorithmGroup {
        case "ECDSA", "ECDH":
-               return winSignECDSA(k.handle, digest)
+               return winSignECDSA(k.handle, digest, k.pub)
        case "RSA":
                hf := opts.HashFunc()
                algID, ok := winAlgIDs[hf]
@@ -559,7 +559,7 @@ func (k winKey) Sign(_ io.Reader, digest []byte, opts crypto
o.SignerOpts) ([]byte
        }
 }

-func winSignECDSA(kh uintptr, digest []byte) ([]byte, error) {
+func winSignECDSA(kh uintptr, digest []byte, pub crypto.PublicKey) ([]byte, err
ror) {
        var size uint32
        // Obtain the size of the signature
        r, _, _ := winNCryptSignHash.Call(
@@ -593,7 +593,17 @@ func winSignECDSA(kh uintptr, digest []byte) ([]byte, error
r) {
                return nil, ErrStoreECDSASigningError
        }

-       return winPackECDSASigValue(bytes.NewReader(buf[:size]), len(digest))   
+       // Determine the curve size from the public key
+       curveSize := 0
+       if ecdsaPub, ok := pub.(*ecdsa.PublicKey); ok {
+               // Calculate the curve size in bytes
+               curveSize = (ecdsaPub.Curve.Params().BitSize + 7) / 8
+       } else {
+               // Fallback: use digest length (old behavior)
+               curveSize = len(digest)
+}
+
+       return winPackECDSASigValue(bytes.NewReader(buf[:size]), curveSize)     
 }

 func winPackECDSASigValue(r io.Reader, digestLength int) ([]byte, error) {     
PS>
PS>prompt
